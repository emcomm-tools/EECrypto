#include "eecrypto.hpp"

#include <stdio.h>
#include <cstring>
#include <cstdlib>

unsigned long long SBOX_0[] = {3178163386585826730,403813234135364070,394394908787003418,1432019680863820488,47493403600563646,628444486146070192,649157948651683050,1152135285835754718,812848008635324814,1265982794682822120,202979023788955845,186819053111526576,749331555671212516,1253565307396611632,162603238383467224,21760519532181284,3455713633201421760,192486161762245120,3275499567139598678,372353900668826193,3288077717743623660,1744311158364704644,1628224332255946336,3130771964300948969,981228242615724,1179877656789509816,1515003442284756194,237101621703673050,328950943200336618,240549104577507156,955695322340225005,811957030592627370,2544749564572908087,185533445102240676,154287167997143620,7365183670290567,1444942271799748527,3716463357323543009,1502817161041466810,631986333992807235,1479262983464879864,858494773496383400,1563841201674991257,240174012619763070,1905620050338878664,906588674080786125,1585055942111035215,64282877143093112,1824888653041796448,366567181107417213,1673807403438541680,1451771834969751494,124041329548436250,1543610598294426790,1764924915351947940,754542929058036481,503413859879500311,97201674564417250,3058020086879894832,1157966539291615130,255743231038619772,510737587523476560,942096354077776478,284782799336850166,2481103487049942698,82700790343648510,2499982577030410705,233214534132355530,2953735209360781596,2207309072588853610,1337301831028321708,1112641431010721847,1196660037821141617,3406113435849874900,3343776740959458000,750249287224521480,339914913987835872,4047296802195240,42645512587683720,1118650597641979624,1347958557782006346,604138648003487704,1509784215655765536,98533409176046544,295038806917715280,707055759149035200,1164628260974724780,1037394855064333432,644971920559839963,800149368325237448,129899144111808376,1336963406972985725,193663542764699280,550994927841787287,218831621711691296,273384441983260585,136284568579281488,974897737137472020,428459594769026730,60633204124871860,1010794225258089669,656374328680675,1498543787806220676,1759833555760984858,2112559625199062394,114236011017649205,1041507722370605640,1584789052766647984,3030509770654491783,246934773483435545,22561192366310400,2280993188830588557,1260291624370337724,25560794593321733,1381586420637056676,72286483403857429,2788532960680305550,1531299342072992809,1493756380622499896,172809161910065250,639870612761599296,755268140766523437,419955977722227870,932303880115716030,503834562465019618,167845583693692135,127847810133996573,3568452009469911088,342077236080049728,491547514252203280,2959508259216134802,3402757071973215523,293119275427495414,90015741619685624,1470713605133267700,747704432139949764,3025754606209657384,285527053893801147,35725144144788851,974945556345750318,6475059039691605,1188891450580470912,2339035709048666991,564646638211442316,1503268941881750030,1190565669302411247,4268388832826864790,1154304842548429908,1431043212872073625,1169147943146834793,878395089645107328,1876403998452199430,799683141592398635,30684389429862400,1439600156985462879,3086065403440503200,3124086905350193920,923885951719840956,199631764414398152,302192068236012312,110883183314765960,1488190198683325150,1930204665169217340,1966414826413345968,565864337312873595,233065612336118625,1869633135817717086,3488985988869557123,450305942372500896,2260842818084471900,4225260605490358028,586053991612381548,1628822641193049302,1096326476745290139,2017970911249199569,657441489457905337,112656632612632706,19518700933047888,29708913003800540,2350168420985977707,785985109622644590,2143276844508092922,1515049896626080308,999848533284712102,1265180289806566896,1812514108203070176,867606100015968648,163206078999702400,1823415434017018800,662888168628758232,1586238938114959024,2207290595890724563,856664144068728905,163741552466871852,711570473793722056,2900964425784293061,1253844818303752320,1473393190855761240,413966138371688800,2789338736185255526,1336792703779311584,1414221422780033196,52489049183961912,96533402381572058,410850490381293744,17975399242241925,79621411830330944,3384125266326847840,1798844727315074166,351881742168577614,3237128890723935584,3007158056682198309,500958467057439263,188206180303884032,3034040929700148812,61987640121160380,2530877757385977024,892860614058703594,36556616538313160,96669470574908821,1097825672644452841,10969871921942751,2120758202042042248,724437580123106048,571228562044506906,1473304847275591336,74268786814457980,3229538421967302,1010182391002576418,402227245599996214,1455751442812566504,2050276840591265548,1527305908959278652,1146626231771940808,4601921500903582656,972712362944947392,2924866943156363832,1744496466369175422,946127102632076088,126475407198307796,3340494647109612,2699195994708578820,81828011467128688,1822307948938172320,2941706782904686524,1033257885419959152,3031550502906692844,104465011990458624,1323655141861116918,259859074708833028,1058832530438283972,1289613217924077214,318808457451224832,956653222916050821,1871389650299370966,1925779884075143223};
unsigned long long SBOX_1[] = {2698161405911582444,1080252163058142048,29027678776223094,1120097019204243124,343799280851515858,503543293447972428,1905258763259348200,1115024872349334542,576441545470491012,622424521613235605,2825031481165899668,1828001584859411640,894406174100448184,1673134085429741232,462892767438184217,341640881621715590,1051406495296066364,2506424357484513318,8650419237867855,1997719037000665180,2830349502799600470,1429806340977714192,163170784457161025,524992377349686785,588249783049393539,1709698661079660,244367283543515520,528686521111564350,787058074242205980,691449682494992382,705447611232746460,397069569210422900,209586403820831717,663911230389061391,873964214062522660,1063290404558042472,1013311229062324688,1887373802427448500,932035309464623112,725292709839028098,266718598442832624,1920726219771372125,2969632546289528730,316526905473903003,2234875003445369804,2409755244927177856,1104834304527917271,1417989668664337290,418465706268483020,1504084186584169404,306015115280732833,987751146537585990,23892004747177064,2566877561799775920,1541569575623120174,1661945732298571527,627787342982530272,677192848677793385,595836576556665100,150652699196301909,209904206272084480,741068052640586489,3280780764581309216,166323793956944763,1071141034889693511,222252015211864132,195700064150210144,115954008883585529,1068199134271399943,88051588538449740,17071947277354622,2247547167232781960,263816099242413290,524281714773606738,4085498905632522004,80434290991326852,50365952596599760,1461278427685847170,6403118225816448,92725120417178712,108652557842146305,39376776917048428,477949319125571503,270918177059452839,1611083512301419702,2383470641467185594,663108383300894628,1339769927832273340,87011100002500539,54509048377910378,1221644691444216010,143549813226175549,640870921343521022,2415246822867118055,3449882231400072720,1028338561717983360,4217883528786290,378397468906006738,2153289054486237123,262599433428929778,527574430030009860,117661243007246904,507515446333497892,533634503922618492,1236771566507773296,1360368722952222704,3874538025094689315,891840662892546004,1282396299971587140,2540773890611918392,2141898912028839168,3031920697598287512,644431571602606962,950729959582695558,66411436049426888,436648282323359813,777065569301966644,944104345152390048,3136533779580814659,4064761077554572684,837897594474574680,746230672625194625,488586415373417850,274365448135769088,1703854217335091825,519260954703979996,2013316332941528914,32492231259507935,2146999624819411390,622143419257604502,2341860318647117400,1607302021771296491,2247853573782860149,465405514900063003,870107239134083140,195666673442880532,320482434220909704,476445554668649570,1052159468827036504,962777157861128972,1058340857480317247,259767507233153010,1340225003434411800,3716252571527742274,69147790765347366,1813554653560881972,1713683125082729250,345291397566242614,22876645773489444,210785587881324172,837266602600329447,241828402179952630,2470472899352600248,2289772670322716593,995164563004854094,1506665073204118047,1420830895452576100,1403754244607891909,1143080655335410079,484499651330862345,807542572971412630,1280482982037928656,152485342545254565,1750540893881620050,1516853861064476858,1506080322856194660,2320011727707739248,1048150627983374160,717363422871730570,371859664263226688,2265214407063131776,67976651020629108,1711844903818125986,1091879029719163752,1024002414459681525,12718987126775353,703737871242014049,143850349422446832,459913327708607136,1139617502836788882,449799435523762912,410199580375771798,311171885046840474,1036957891131000623,196449903716647735,1408493020846549014,141478183826065179,1960368252229066858,1830016327314952155,800206302308431320,368460877478364846,46926190914699724,66400560706305852,493926609417834872,85798094749659107,149778839690010360,2689453148815642482,2990269498146350098,1117729538743230306,2998377002676750000,184031981572920228,1399188422196189936,1478691252842882886,1370528779355759772,226498461018870468,3462647252371002450,2835418808041070172,566053143871853778,11218082069375290,762776112577170033,4055524823597560508,379971973098365706,399267023070496923,991688455483748838,2509762062285896875,2597678227076292940,151824955849664331,162394241091749240,762937354770023886,24131343632052384,632671635649164907,1219537299439536944,2235269214512996460,351816629822845410,646994216881870032,1525144086217355450,1455337480831405800,3086833065119535160,1998776591684184824,2166910248321925260,1244858626002568423,170303491746329480,2871842982044175120,3954437128112677443,2465354778946835965,21600005934195452,1817353674172101318,140623667205170752,297716503933331392,1110694636064202486,345038492683444608,440557439723522472,229164065701352964,498751617985911550,2163201445118977536,41963369330407967,2213581185530667677,2163114019608538743,2378004463925091412,4304230369595792976,2103466499806203048,723649024159351556,393587348221614838,1532765615314183116,359984954040516131,44345518404896910};
unsigned long long SBOX_2[] = {1942954230684912408,3280943956606917404,130004070972508178,2148369451054378500,4135538099274156146,1111989688811598780,1135302380142753620,672506343819614718,1734422297640480,1817873061382575441,75052396166169060,491972683100930832,3778321804472503380,1205519659284208424,355926037859409213,65152019362110786,1628333577500501600,237578960752048090,505274662060001067,2700115915955115840,525983831625349890,431794300719151500,33546704867966325,2281066245797229369,363633228845557347,443870244094241216,2414478257346881804,2004764869169444190,554768496724609656,529140603506906798,252307208740464396,658081501647702664,59979130435053,2563966299641517879,718141551679212,1100715527139267936,3330082549027224860,472288690403796360,195266735802757600,574170442171063650,1608874392981708804,26529300548572465,1582545419271291062,434013271984945263,1734284891988613368,771840462910375820,421912851514731343,124417160561656082,1046979982076769444,28931811014749500,112757362878221253,74906025070702518,26567168120924332,1282882971176077740,16412182225123374,853067353552047431,231960827904078840,2177237298587418981,3137118199331987340,409557227755599165,71938563816521840,575534127916140965,402395277050832960,6154945021702251,281743635214661675,332602919457329504,87084070553162112,1979397520978728117,491183592529973115,2594542933922752032,3688077437131789030,1496539248258197376,85267143710283954,2326335344760526902,854944516127147460,59171878080428472,35690830692084060,1817581311240368730,812242075900826284,1279125719320209680,693588564887525253,29235607080081492,792605297895807555,3196873663100946507,632971601021519370,1598308511406761826,555691570647926200,1196849506309956576,673903458236413915,2507308383897915650,550473960843471686,1004699847421202285,1741569683914499866,2781649082641122915,235563437562083960,360955658127356084,162103428014820450,429468997479917598,431039812181645511,424034053345987770,84546635299128984,855657062248200656,2102351726031518868,1348048095082959816,973234275340570948,2193219221396083356,1126976211181825011,172172482161432008,1270418642320684168,123103446591831244,1315642555228835400,253752729350872908,745179283133950150,972298427581299170,393246474104206348,3024337375227207765,200125054223550040,1134671232702453180,145318215065346939,2613025464003660200,1351573602371828976,1342619452712194461,1368763463658494250,1856422896329469980,219619873296645129,931438698651233280,100191914445582002,4126876400976934447,33312401829736062,3411346211947832494,3044819205849015652,2104997783182769295,110179917029467521,30825183657989819,1133508587842452544,1271832527398168736,234440742282283236,715787703790478142,610359913046732240,123166184968402128,3631345141412749599,991396595532464534,346603631958328000,3731203031190258474,1165234689985597902,241139836885434268,1297613171301122742,662778735137855766,3111773330673284676,3255316426292428140,2675537568539352335,829117838745234954,3419388975124616000,2709086435888107341,3456632142916527666,454929468452453683,2538565297933123980,417450091547460165,761759698077722115,342884542985092557,1512568330674398470,1003031318439430720,650274695986851729,2036214811529200734,192726112314608230,1520651917934796484,1727778492419164440,390153262270288220,1321710118071818634,557472343392742400,3502221693559212000,58193497160996400,2413479488077410242,1132611101942565200,1681013841696329665,775573786178413761,2527841039277849497,7012222967743400,56395946521370888,448648821421863090,163505411765684352,657548171463631846,3863969398271732334,575954375849615259,1080126017240687959,115927944205430322,185267432310600451,1213850869192427634,417158819727690579,1435562789672298956,2933537887426227906,197971479658141440,75229093687689608,2396776656495062556,1374744523868047395,750678829563800256,1441580242811740074,1176537768723177990,244163282807509038,2950639811415859392,1240276819851903888,924389729107336980,780901093203193326,815773758816267992,446778610309758480,3608815201318712694,879570515728389472,344059327122142250,234630602093934090,1011474328895929209,1450152284448992292,126770621685779478,107812356116784095,72737955890233622,1243775843155347075,478274780958407972,458331916878523935,273040681018285340,3267427962635566338,1289103872226623924,196078334716211483,88253564967839052,135424894887476328,1842865269215776610,1316371278022706268,598798376419951466,1231377101231821776,909383109605600800,32069735485469444,1741989849058959608,3954257206575284135,1948506160002983280,1155004374794511744,3014094617842265519,1205152849194654861,87193088375409388,1557869781401851610,2288982262193425524,1215995108946741576,9892088273126374,565848759741503520,293454613372240128,2866954338040629936,3076410434851987566,12622289839736160,1521451646119389007,2213242413900816141,298672717521786947,1242525695256684840,2706789791274464804,742296658399355920,781291965710813648,2765895222725581954,15617602236349532,13514641365528047,535486237396663734};
unsigned long long SBOX_3[] = {1180163781560118068,73215568578921592,1790566517717043850,2765841857677197572,550099414941482518,717081904158119500,2517388983033474720,2047324065776226290,3035654747097429804,1208667578548499509,495649669931248532,742641609710897736,2465182855202121808,1727746835567084192,3369919543112845233,156466921919544762,1919255685105582844,1133462644335173698,487556665825306651,356550999190550500,1900097482040134466,149664018196426968,3358136718889208985,145280611296391905,556764580971319935,1947943416342408788,1956040908234418440,1426545865047042738,514664783032851180,816394308580287242,916373363478041260,4334471821586063756,784826337598541029,337073957848945091,698848699273133060,1056613348282164152,2294987680761432360,1167556388650796300,753572555208945096,437695492811371094,2709939152165165976,213838560548136485,2410331182258087462,2147323672318905639,46707927490342892,1019462407649739640,1373980905478909563,72901130578798382,1111361710973010748,563794710709508124,1417268656706860545,1148985840899695810,2588438154869278688,559656869192559000,3860222220045410,2489577277539060107,457368391082307600,354710914991821809,2502169847575692876,109886619440277421,1382152412825757312,1869552078627705729,1199399210316123648,2325416480680940655,2375743425801351795,456847935261933748,45811657249585920,28201609457425425,2027081472629622675,578187792406370220,781360683446821898,2992694044168554344,518052143417604390,1160424002307635670,1096454856875181636,2905381100258972620,444769000362509960,122183675090095038,489514542146926872,711621128405416648,639820580849796081,110026836507174620,20703855263636875,574378557352069691,569654489775491250,1536823474359486390,1025796168950740668,1683637378309180828,26365501614098287,1090266607987148318,476704497723988566,2594863258881903837,396768277156486122,2609372372993134515,2812381135614812352,292400780666640200,2138080218731250910,502732361340164350,772477656486653415,3167881891955070046,2711128328880136900,3725092331846666472,128141709004042052,511450549617476268,988249133909828200,829025799013094456,1824196470666633799,107393481863523316,580325215186828940,1155501493096254384,2864151877963294992,1557212591345661184,161300956022256342,1706927472220293930,398599964168065520,3234048650911139453,300988565949511500,2768795203015646520,3482204713030007,156921728228905204,497459926247642104,22297033014363081,150647615400570750,1440116341878774648,2182297958264660657,688560121214683036,813360590462236542,95473598394761811,698464427522274738,14882417842131186,142628417771830480,207044626596727535,2127040720133229085,727830675080730975,527735122910924668,535853912756815900,2058853529535079920,196783865627707982,369451631157652584,381789769705990900,2413634250301906803,2943042031970051070,222086073959424792,830187198025835726,251820093420408546,23809926480695364,12332845768121518,1071280694117471362,1931455132530948900,98719451746783980,33061038014404371,617763432362519570,97096242093510360,456810887720604225,1569977303547398490,3556609652916880875,1375276712526910740,1331288277207840525,27169367404257323,753116544139126585,1100457884371791234,312614864693758640,1125988230139214685,16938707446040694,723216637415773270,305968860201962964,216618484517939872,76496265108524360,80692572095462670,2466435717007223328,123486358188316512,502256736289042436,960197123254875350,476025073381724856,1793931661004200509,1620651002967632665,3197869855323401025,262951757628652800,395686954428305008,2141426127899443350,373942918628454080,151736296428464026,332622085711026390,515732652552223115,4068383727115181115,363910018975174730,672209728158747975,2071071347495385558,269425411537252607,2444636748626914720,3343121925099981050,56108274275667636,2856246614304456900,1179486309729156448,2303330139558779463,32884727571993544,1168560245031169238,1931795895753746486,571269287339234718,135130382173072176,84965470667860380,446396219658014520,1943833762208002714,577642050454927500,1669038918541998836,1196139685684853294,440937704447814708,120371491368630710,95446902771540606,2194243422489153,163565798385714156,332143070112817494,628136231074862039,1103845332028044130,3110659884974724927,1488334358705132204,582684206314097007,506857182067564128,132030346147960130,314574143339414728,77476592661679775,1569441743335021000,1406059416050388180,3480438532145954238,868554393591426680,598783337203098894,1576291540487564040,248805034958788680,731868759414405920,1935404444109338972,198630802320311307,5503351203251800,580471128024548400,1275185827047079575,1194069112255073509,266584353174330876,2763766823144991930,1885465425424127960,650203908128186128,350976476510738850,507820962867389792,187384519084801896,1867836735494186132,1331495476663433994,1138915000762991200,1538575611451570659,2544876260543102045,417830183648135099,1270518177594642060,599458471811474184,538110840357004936,55679193489846420,28082098760032146,1326658865195414604,621731710355100303,554367211840017642};
unsigned long long KEY_0[] = {1589851700726235044,1018845706467775056,677971941299989518,3014763156508752756,545171099912152506,171050875857708380,1133715346179623224,558387199887524750,3011965724639755900,392803757418153837,136400660975096244,1458001243647572200,152741283931365816,2649951283583046800,817277846364606297,311307511091785254,1138552719154547620,498897956510081622,273975028215287399,94748915948873796,545631576991471686,1615757335906188000,2279522941094928753,1393021482475464225,1093339089580976435,313978311196879220,425236378385202032,5757968210046390,314884959313014916,347979277405443270,229524255259642092,80550112659811116,913615541775850509,170850612320387927,79872311704425700,1632417669256111000,324433483374467872,1451438116339841404,100090469251243000,2153275318270510482,136353393167279552,193480825995168965,178976675906429562,441128618971150235,779014662465660036,128021324519879952,754900948584512415,853937980001252050,3377159387405484156,399285093224612268,1603110690445056289,474506876800679838,1579038084874168,3492266234021653536,2706050016688052086,282889461736096815,981330004931500224,2873482494453588905,15857339230679100,362775140591301421,2287510334542551680,110156326554424185,690681014453483680,110301677152172475,1018852909502168895,1301976257996579836,288861851625922592,1415828860016748345,67906432480377183,121732153235018676,1985150217755953878,2253169315268571960,267418546406443530,1626509036754711450,1805810964228991860,688165021241091612,76398605427147136,367158822215479250,253569082352305296,1391379892808821800,961340299804245777,1816438919349944220,1369088167972104567,178942345461657631,2615526855944963910,197624482994913618,339063902140867036,2245248627267503124,564890684354942715,1337137450740099362,1467877011509080842,378012755715884853,1435129580756566982,89625073415804703,1365804396159817680,2544278003053097200,654320654681435490,583938439204014210,222643846729422035,1572695657343120546,704200281529694268,377587021515700392,44494673804768292,2897162324458022836,343510395112724064,2658540086465206848,690475961081615139,5521715303089580,1139507996051044780,1276918742135850472,335219637796005600,455611964245212280,1365766920187463610,305331921315443542,319593613087534472,536683427935817437,172794985211379900,762924630324580368,1987533231039540355,1186662915054664068,570494967382679176,2961154331025146625,2041289665719475418,296719597391318960,1188707416627672545,2398642002223714500,1035637318523611066,1129021485309658871,2894311359505902686,1290058298831293326,1249143419506364696,919779924894140475,1777131923016075229,843137878820941707,19849263325844940,45292821346982540,1118024031516836184,994756391937678642,989379601358001672,17996257996760692,162372923845271367,112484918089908738,245871210508399944,2615575229227389114,438237261314413014,824377364374837556,54040839144699666,2588658332353420518,2327925841345011300,1564049020341503388,154242774987538799,1415055245659258878,993744965851932840,185933164808604529,222015992989405326,152076843725341159,306947860542332100,1625344373418287725,278573377726547319,173185130077508857,959868094014294950,947844641293867216,241372259113545469,785081774273439330,12234720633342354,1500613539903740932,2746629742333847216,492273233905383424,158000577593966730,793035472477377024,141916493377667008,586005164076295500,913927885482460218,330699283885090872,42169637290216813,1891121193008680105,1228644303040137553,241230486135514224,166861895221040000,357098706412860450,1844459002666708064,832687684524322022,1739090877294992474,606654923443206903,3164130502699365983,314526650515027750,2333390750290114875,1081242349964170218,481902728990160555,1128096604926011448,85765784822691430,1399125167108210868,1252988163346869876,1927151552245964120,350614391107331075,205135053891785192,251534712651710650,1237268496200949410,549654870329431090,1727616764466389680,1295281413863106348,548544216845780064,402461271625370854,146766915161335940,1630416861084068972,183592533693180930,2105352866504941812,2696145228793317154,1541911770527693762,2696234730022335041,2288039071815509292,4517396484227474850,737405759327305275,2135866047574008750,2951622326600617995,128534320860450748,97736629519327723,321292179855624856,1221015132311623350,1914001093668686000,1798622164599332443,1800025091658863520,1167605986449686868,1564512293889042162,2217450395218625760,1333080193314824010,84875565023600120,57857946008821896,940941222138671352,2421052838409590500,733715151334696783,359489844192752280,514174181392590096,2570712757722004675,2017768741838822389,296059565964508524,390734114085840174,1475186000566559504,443938955093116896,540666049375479118,86523863756132800,502656505555465432,903919524765058620,564097980049739742,3161734302143024320,2920009507479611495,707596926782066549,120047879751977855,707622894560008732,405966372135373280,21991125306259224,1094117145615434940,2461963516794052446,540151760448429404,120921694459525251,384352559380793862};
unsigned long long KEY_1[] = {114395799983614300,581737672286553664,629019904585194870,22084542721457044,1116796187319160834,415300770578458188,53483091586015608,2777657746891135470,164268323635126292,98496133133941333,110418600616480884,607353687120459992,3242074306534884456,190609149519130960,1723775853876791865,1094699413521525526,735707385756571932,2692992839986450758,3239772878612856575,1175189783041435980,2259624437263647174,1017710710923515888,2481105611182171953,347722747631330769,284594208802638275,847426395552841980,1956431666679060256,712046393903922014,1300250609160972924,1369882142930921630,214513445800091068,2643055081592342884,336798173248409957,535262985197894015,34606283445834852,2137495844170550632,245378283569864432,1472740535530999540,952156417853553864,186788016300845154,227353492390501104,1042962843026201517,1346853636077650074,3379402091569356491,2698621780895020156,199699072346471456,877214220432380215,1881683971424547946,2547792099943735820,260966278034700380,1964099600491038625,27350057431893350,121833320163649016,8538632970809744,260628946539176334,400328932131516423,1753529803247795552,1885773833207030745,424008240903833228,494707537381911989,1953070512963418368,174569725007237689,495508064327440992,1357675944459890987,1410432013152292039,27251341050205140,948096300428617760,357596362588497753,1705181274846524535,1442472281116829820,1003975765212728110,370039233941734280,600489880614690362,4064626262313500946,74309437409211060,562411779362861412,1746438531781685776,107034617815218258,332170224366272800,3640672653617613240,67911402047368145,3190941120026498220,103957507519627839,616712547511349991,21035765186148918,163596663424147690,1946699763270834484,393822806938607340,253107967195995435,229275392263738650,2476110799262612026,2302607160913088013,635858986046761278,915268804412162183,463483007158519472,639704189152953888,1543347206330657026,61343573743897570,3040135193516275459,23498816721936178,630361906139130660,1229194252275069240,3421206327555239332,3601333611729387100,238700399305952976,1876751560087929168,2649417335417994723,3012088912829027636,633840710408918964,247458802166132744,438665800943843520,3097010696239737032,2535834013557963186,1050505514978413830,3233069674684962936,1055708574726336773,518325286624299636,1061223087910529280,53477080721077635,2111353773115753020,3070612852681240,203684782035954609,1617914005118368698,1410958083838503840,392674263926052129,126306170931380668,174234238003179794,2721272037198217279,2895036007575717950,937108742738670150,2621588496841577096,325720289176214843,2176420294359484885,3973965917468441931,1387045295468093940,63051358481618148,1891147803167958264,292522932777216834,2133644731397827064,1306183345053217068,1035162721606710783,3814744711722838594,2855436306853442200,776984250954320066,1074409222599257590,210401573288062420,52808104915475538,465170474729022438,374518231429849188,54693096145428492,1831539363317290263,204177588936043062,275673299277448312,533628449274180465,760925740947628734,461994827998953583,2403539371171945060,1324992499420000005,798501394625138863,1395925195832831657,508226732117257606,1720616196572171856,1403789349742370085,3118128565115388594,1750455508993457850,2555444816270551140,432881292402314448,2153878650831670096,420532914506870250,633349073052286784,2602173114115430400,3091315262715787300,31690672199681010,973291962819533544,538349713268657653,1218378180627706649,2088999027833343185,142760998920175824,978804392402075616,970154346159627570,175017403739733664,111327913442784534,2850104736576284186,2136606058391871231,540884877055667703,1338866802947533398,632732083843967115,576599371626992922,243139878694065675,68366902205624232,153924627205170366,2792233304451048060,2002982848930651500,1229678521107748296,213292870591116131,336451807164294552,2985695655736870050,3024311842945975410,1507477049000952450,759565952183116400,6790204031609796,219276403449819696,90581811034885078,4447638296329128316,1933869449798593044,222209059927262226,1537547993726185772,299180198672963730,3163364010555775290,3016295802940204833,4015337211577239580,231225926354891370,2736872230490151211,143376882377377110,51447816335053819,1420195668572776140,1276268797220424795,797772542995733160,1085753063764324718,371990862447573888,31069024358331195,662260491238440688,1009861322697780364,330242159228464706,1472108107718671792,800624212668566794,2674434660713611144,196285680490256280,2193588089541494280,394913006895454348,116084952291449639,188438673560159176,850020692640257808,1263345920912674179,65869383060568269,777619754691713500,2457849257441398774,735492665251314720,2122319574039458560,434743978074999030,457564180535731200,155935068717813480,1244227580420287332,2239703241292134510,2804491196345857152,2739355315319191887,3043679605661362509,1076172075452250359,1264319369890620372,723266758699179888,2501215096523228328,995777839880142804,673004672829279862,1525678689134439756,1339156896080895171,457130182667351758};
unsigned long long KEY_2[] = {3063037549161042868,1550698316738632360,1111155839396753850,2987377403870832900,2581509974619214870,3124542667958822732,1323897538975409088,3930085190261153618,1294224847757881676,239170999998800309,120729479097940596,843073054654210792,261253720491362160,828430775306021280,1277404907095656625,243315819281642250,249958440974267548,1818709892092046130,312778730728345035,1262677261889574276,1062943331249028930,57121281650004264,592392509857221273,738390089126704017,640230741434392511,260534469904910388,1340509547573288248,305061584889438146,604829883941857548,691100133085589354,791363003094084268,72355012300427500,599480832795484965,1150699680458711811,562138694082718916,527497622476098296,755731569418723320,137810265852547804,1031665321162372840,622382580965610134,105834574600445352,3652733378176869125,2279284281333416630,1166912782920952375,45599512758973628,14749516626430888,3622734159481612811,978487140970330654,155472726171903772,861100360715717180,197565416313445089,438559095919715330,358447675059819008,305464980808571720,1274061916504826130,135122984649249723,119029072737773040,1627183474959157569,117768327931206668,400927672789157309,4103248327101936000,2193196642619661425,36650947336996480,1870780697860508927,625619116573046259,991450005386129540,2712959054993143680,2050322901902308737,49425718707457075,231863178433463484,1278137134412434618,2161312422966362568,1213033179341006790,3328732454890266502,432076066103860612,1432772315120586396,820857088606232,2249898794220597662,165111921169280136,106325521693308520,2116110465253894065,836735772154153148,1114322889232342075,111621613653887883,1778711053726089858,752421821552228198,64600710800291548,211166296167965868,2919521795287706767,340742155310131806,1865241061163492310,1313364940484773773,702972552255162954,953025979385018291,763724689331184384,466748673179961528,211904615368301310,339870261067518,416584424946327495,2204365461561221518,1765904698999031844,439222873728252264,109642547690251716,781440003456795660,375858939485689368,636522235420739720,582338090783829447,845800163939251444,1649040306997958028,406245798038511664,1897167321186064880,896356849111597792,716220302051097350,1130291463132807690,173062404794946960,509943629340436301,217847240946526652,1054047973630788584,787366104731139207,257839523877533972,3013309282530840,556050193522938105,2344958931022302910,949217177696912168,1880315559258310145,976529321055383356,786208826428658622,413103272972130099,2859423476959873042,1384441164493558306,1556018195566324560,67432908216758751,432260116463956333,1305531205184607007,2978988269806782108,52023322580948348,2778086760161771824,1299514560328301630,2712276959431968648,58526218297219684,746799085792784467,842380466044664030,1268219950504718904,2334970902117130030,3121245463592244674,324033017541492420,260065139084978350,414594104249008674,112190456592864996,300919815146175596,3575457522488102195,136983929847767442,2415837459206436408,4286296093297416257,7028309650431450,693544997362710075,401072298345034740,3243522677636210205,349888674325506075,578596839634048905,3387777536719767138,2875058312285999088,229476453394130605,1181598346286787510,3298351373938879862,328398148672848180,890811947350122144,1720096751948829912,353986317458776782,1512340766697095520,275631594869717280,307449641425720116,2458630423465340118,142338128528929080,1670259105241089325,409170257912713145,3430310750997136433,1189472755601632960,721102580197348368,573898610627729814,257533420298197696,1892487319279164218,1471072574806741830,836278412047395963,1962831868859435,1002257692810061098,239490688767238887,528829585698199830,502422641080509519,3965655866301955776,672912193716792490,81533950399455060,1512281039677662916,1065120673715928000,1676206933735474327,2078270922045470952,980445844139079126,185819881308755382,3393218568977778766,2340940472029566704,2796154194804776780,884763181948173800,2632378387928328810,438145234606374860,27477683240985156,4036626174846407870,2536790567880543828,1409102867673702838,1326553038964392750,848308987522030545,406229695616475564,3543852504645957526,1418869112583173271,1283126946012469074,592897980450031215,65186125597216620,373764702007072143,1375358880498524992,2948771896764727410,2283755989208788728,212371603429986735,202328111269093176,845778545900569540,3545294306706386190,747683054706433864,87466630656513662,1215267865160659400,1303846122570167400,1643128710898327552,1195716439408268092,1398528894506443227,603457584320740952,2152164234926009328,424407417108885847,143656644642610149,1069042542780071964,2314393562134383418,101210092227113800,120402018173768368,719011097235835074,1880198566635517344,255784223762535112,2983114787278513012,1574471352435454410,817043371110964896,357223317818238371,59065176242138669,2135586633088858443,3043524356005126076,290986827800332440,2542596145010509224,953647524125622980,2627759554857508050,203795385921343500,257486803805890431,1381019553263843850};
unsigned long long KEY_3[] = {21242988909004640,1440539907318694204,425453406450394206,3396332623908435428,562596924564753822,3561106939191564,1459354070294868716,1042008905817938610,2494544504459241336,2305245258792622113,3296655380364649780,45628715155596256,352677373272249372,1197078153129436120,1628026530928153629,174823360174597782,2220694358805811768,586280690085147462,1473596090478835087,195970653829767480,1962313393527831726,54961127256867780,2026429803195668709,2130680717468022505,84863476074118703,1767044418169260392,726615416475226292,1222013813023885986,90560825793952080,61423344256138298,1795033327022651820,1345857986096788320,1960666281286160725,2183853351357854803,2271175658986828572,735430893695542512,1001896456369751580,1148316563770961824,841746671144103120,1517782708681845478,1037147954770879644,1452230389288943505,109035820948571346,397115771743738395,102267018585206768,533812044408984900,40147726033322427,233249596154486694,2315460432489253524,2349342790814640412,1307057173658886701,1527954400775726650,2186879461002285252,591345538133429180,463897978292332298,861104397945205035,2040960544976547544,367499855690266797,353287179402834924,2737260570126424461,848290619457559888,137525476517090725,2081976871860885792,186081544172235615,156486686449287255,3359093831042836504,1093411401141208992,1870342358553271005,877241212427192775,438279957776799320,986950552873363650,842954355073194224,3505614320583861510,572299469390350650,395177890345993956,456628145561090688,588700695327576436,241738770176419830,37003268635975180,634495810935329280,2670949313585930325,2047649727047750596,266036972094137879,2649236439249163431,2154834897196507094,116291768086333478,64178444545588368,718631227978935736,15509360507150367,1064433192196570110,265510156089540858,654311575731246581,503731863577550734,726897800318823183,594491482852964216,1992051036778297092,1508056701748583486,161024205001005594,1269734115296622195,75376974597653550,3308866964698594832,343662735361760,115833117473250660,655009545590492400,719146821293786812,80564706764762604,2845580884624818055,93921851987564256,919734222657613824,1375138209053060420,1271958990408473640,52036878689919140,146357215395428970,1025549686528392662,901067999991640812,558885625286066565,257916485468774720,643694472376478356,3413967946458157575,175382444811862608,959712042912107040,48393946846172781,581232607289607942,1915768991640008772,605848856352391873,1889198350636064312,43318454650744350,3046808274577588035,1106467602438496050,275324697437858970,546795815753493300,71487529002681147,2047333455265373545,3010760210057292471,450551271485964744,768744742657896840,456889903823473044,3984583965618973018,1455530966073688800,32842742875418728,202572143527045299,373320237546553210,2035717829277139056,316146427847914118,3587365788278215138,961799679296958348,560853718960431314,501813306440494538,543416320568958564,111957432340157580,1300341030454425091,1742681446692690046,3493561127460890352,146532298923050341,538414648023954678,2474689584475933847,848232821673246156,1052306099609076365,611645642958331527,76684891012658637,2939736788739771274,882375381870844928,452726142114270609,807459706086794530,605936109897580666,767979723494734420,3003357565040318904,855274008735463820,425667937044000966,1039573901506824288,726744324296561024,486868788822491064,274271833753074326,65544002272617376,806426022393938705,297207621883394961,271629127953087849,2902274369200811848,36782098487978200,1197995134150783150,35469499125657696,2470288791226050,1148970397835683098,471300875485481175,1963359125069311899,3064498977173547078,232109230195608375,43814855409136110,1187728914211614231,566008679676782004,61273878091841550,639155807080868792,72846675060079104,146253693845564156,635639212790519151,486844070817212752,2996660347544151750,1210463765328155466,3980641233379051362,543362855063555584,513772925967153048,313884314709820716,1477850816288119698,924803922913650112,272860465201059736,309905366578255690,2808368694633993000,1770170919242290294,2336475928965938974,650257618287818385,1858503027512475732,888524469051862642,206446262936967675,2634815620382498314,3276227055735208359,1125411287661785300,209591440300739475,335467327017215780,315410233072070038,1978831231496998500,28790545204817375,57080796959214908,405548689357103712,2102270034318782286,302246269175021052,733372914925787934,175917251250078624,2311967801684617744,655469594016694164,1613986984705030016,378091133547343275,1936274878853777280,3280459094816687488,3455772856832435931,814081728281829469,974004137273760348,2676747972332765582,1112976994140937844,413449218935460344,375037959693611970,1157406860895264320,1092952247277197424,1582768616968061256,343625977238654586,2405018776321061888,761340788868420995,2118952101649425413,222241730556407047,1150240855153535104,3123544550085022500,290715173026519072,231952629062614824,1182137998362502454,2182217897002732236,978275242098672195,703629999506515554};


EECrypto::EECrypto()
{

}

EECrypto::~EECrypto()
{

}

void EECrypto::MakeKey(QString *passPhrase)
{
    int pp_len = passPhrase->length();
    unsigned char ops = 0;
    unsigned long long seed = 0;

    wchar_t *wstr = new wchar_t[pp_len+2];
    passPhrase->toWCharArray(wstr);

    for(int i=0; i<pp_len; i++)
    {
        short value = wstr[i];

        if(ops == 0)
            seed |= (unsigned long long)value;
        else
            if(ops == 1)
                seed += (unsigned long long)value;
            else
                if(ops == 2)
                    seed -= (unsigned long long)value;
                    else
                        if(ops == 3)
                            seed *= (unsigned long long)value;
                        else
                            if(ops == 4)
                                seed /= (unsigned long long)value;
                            else
                                if(ops == 5)
                                    seed ^= (unsigned long long)value;


        if((value % 2))
        {
            seed = seed << (ops+1);
        }
        else
        {
            seed = seed >> (ops+1);
        }


        ops++;
        if(ops > 5) ops = 0;
    }

    for(int i=0; i<256; i++)
    {
        key[i]= seed ^ KEY_0[i] ^ KEY_1[i] ^ KEY_2[i] ^ KEY_3[i];
    }

    delete [] wstr;
}

void EECrypto::CipherText(QString *plainText, QString *cipherText)
{
    char result[32];

    int k=0;
    int len = plainText->length();

    wchar_t *wstr = new wchar_t[len+2];
    plainText->toWCharArray(wstr);


    short uc1 = 0;
    short uc2 = 0;
    short uc3 = 0;
    short uc4 = 0;

    short uc_r4 = 0;
    short uc_r3 = 0;
    short uc_r2 = 0;

    unsigned long long duc = 0;
    unsigned long long lres = 0;

    for(int i=len-1; i>-1;)
    {
        uc1 = 0;
        uc2 = 0;
        uc3 = 0;
        uc4 = 0;

        uc1 = wstr[i--];
        if(i > -1)
        {
            uc2 = wstr[i--];
        }
        if(i > -1)
        {
            uc3 = wstr[i--];
        }
        if(i > -1)
        {
            uc4 = wstr[i--];
        }

        uc_r4 = uc4 ^ uc2;
        uc_r3 = uc3 ^ uc1;
        uc_r2 = uc2 ^ uc_r3;

        duc = uc_r4;
        duc = (duc << 16);
        duc |= uc_r3;
        duc = (duc << 16);
        duc |= uc_r2;
        duc = (duc << 16);
        duc |= uc1;

        lres = duc ^ key[k];
        lres ^= SBOX_0[k];
        lres ^= SBOX_1[k];
        lres ^= SBOX_2[k];
        lres ^= SBOX_3[k];

        k++;
        if(k>255) k = 0;

        sprintf(result, "%016llX", lres);
        cipherText->append(result);
    }

    unsigned long long version_control = (((60960 ^ SBOX_0[0]) ^ SBOX_1[0]) ^ SBOX_2[0]) ^ SBOX_3[0];
    sprintf(result, "%016llX", version_control);
    cipherText->insert(0, QString(result));

    delete [] wstr;
}

bool EECrypto::DecipherText(QString *cipherText, QString *plainText)
{
    int len = cipherText->length();
    if(len < 32)
        return false;

    QByteArray arr = cipherText->toLocal8Bit();
    const char *enc = arr.data();

    // get version controller....

    char sBuf[17];
    memset(sBuf, 0, 17);
    memcpy(sBuf, &enc[0], 16);
    unsigned long long lres = (unsigned long long)strtoull(sBuf, NULL, 16);

    unsigned long long version_control = (((lres ^ SBOX_3[0]) ^ SBOX_2[0]) ^ SBOX_1[0]) ^ SBOX_0[0];
    if(version_control != 60960)
    {
        return false;
    }

    short uc4 = 0;
    short uc3 = 0;
    short uc2 = 0;
    short uc1 = 0;

    short uc_r2 = 0;
    short uc_r3 = 0;
    short uc_r4 = 0;

    int k=0;

    for(int i=16; i<len; i+=16)
    {
        memset(sBuf, 0, 17);
        memcpy(sBuf, &enc[i], 16);

        unsigned long long lres = (unsigned long long)strtoull(sBuf, NULL, 16);
        unsigned long long cres = ((((lres ^ SBOX_3[k]) ^ SBOX_2[k]) ^ SBOX_1[k]) ^ SBOX_0[k]) ^ key[k];

        k++;
        if(k>255) k = 0;

        uc4 = (short)(cres >> 48);
        uc3 = (short)(cres >> 32);
        uc2 = (short)(cres >> 16);
        uc1 = (short)cres;
        uc_r2 = uc2 ^ uc3;
        uc_r3 = uc3 ^ uc1;
        uc_r4 = uc4 ^ uc_r2;

        plainText->insert(0, QString(QChar(uc1)));

        if(uc_r2 > 0)
        {
            plainText->insert(0, QString(QChar(uc_r2)));
        }
        if(uc_r3 > 0)
        {
            plainText->insert(0, QString(QChar(uc_r3)));
        }
        if(uc_r4 > 0)
        {
            plainText->insert(0, QString(QChar(uc_r4)));
        }
    }

    return true;
}
